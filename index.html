<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Ramallah Waste Containers</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" />
<link rel="stylesheet" href="https://unpkg.com/leaflet-control-search/dist/leaflet-search.min.css" />

<style>
  body { margin:0; height:100%; width:100%; }
  #map { position:absolute; top:0; bottom:0; width:100%; }
  .coordinate-control {
    background: rgba(255,255,255,0.8);
    padding: 5px 10px;
    border-radius: 5px;
    font-size: 12px;
    font-weight: bold;
  }
</style>
</head>
<body>
<div id="map"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-control-search/dist/leaflet-search.min.js"></script>

<script>
const map = L.map('map', { zoomSnap:0.5, center:[31.9045,35.2045], zoom:17.5 });
L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
  attribution:'&copy; OpenStreetMap contributors &copy; CARTO', subdomains:'abcd', maxZoom:20
}).addTo(map);

// Ù…Ù‚ÙŠØ§Ø³ ÙˆØ¥Ø´Ø§Ø±Ø© Ø§Ù„Ø´Ù…Ø§Ù„
L.control.scale({ position:'bottomright', metric:true }).addTo(map);
const northControl = L.Control.extend({
  options:{ position:'topright' },
  onAdd:function(map){
    const div = L.DomUtil.create('div');
    div.style.width='40px'; div.style.height='40px';
    div.style.backgroundImage="url('https://upload.wikimedia.org/wikipedia/commons/3/3c/North_arrow_04.png')";
    div.style.backgroundSize="contain"; div.style.backgroundRepeat="no-repeat";
    div.style.backgroundPosition="center";
    return div;
  }
});
map.addControl(new northControl());

// Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª
const coords = L.control({ position:'bottomleft' });
coords.onAdd = map => {
  const div = L.DomUtil.create('div','coordinate-control');
  div.innerHTML='Lat: -- , Lng: --';
  map.on('mousemove', e => div.innerHTML=`Lat: ${e.latlng.lat.toFixed(5)}, Lng: ${e.latlng.lng.toFixed(5)}`);
  return div;
};
coords.addTo(map);

let wasteContainersLayer, zonesLayer, zonesCenters = [];

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚
$.getJSON("RamallahZones.json", function(RZ){
  zonesLayer = L.geoJson(RZ, {
    style: f => ({ fillColor:"yellow", fillOpacity:0.3, color:"yellow", weight:1 }),
    onEachFeature: (f,l) => {
      const center = l.getBounds().getCenter();
      zonesCenters.push({
        name: f.properties.TYPE_OF_WA || "Unknown Zone",
        center: center
      });
    }
  }).addTo(map);

  const searchControl = new L.Control.Search({
    layer: zonesLayer,
    propertyName: 'TYPE_OF_WA',
    marker:false,
    textPlaceholder:'Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ù†Ø·Ù‚Ø©...',
    moveToLocation:(latlng,title,map)=>map.setView(latlng,18)
  });
  map.addControl(searchControl);
  addLayerControl();
});

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø­Ø§ÙˆÙŠØ§Øª
$.getJSON("wasteContainer.json", function(WC){
  wasteContainersLayer = L.geoJson(WC, {
    pointToLayer: (feature, latlng) => {
      const marker = L.circleMarker(latlng, {
        radius:6, fillColor:"#ff9800", color:"#fff", weight:1, opacity:1, fillOpacity:0.9
      });
      marker.bindPopup(`
        <div style="text-align:center;">
          <h4 style="margin:4px;">ğŸ—‘ï¸ ${feature.properties.CONTAINER_ID || 'Container'}</h4>
          <p><b>Zone:</b> <span id="zone-${feature.properties.CONTAINER_ID || Math.random()}">Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ø¯ÙŠØ¯...</span></p>
          <img src="https://cdn-icons-png.flaticon.com/512/1046/1046784.png" width="60"><br>
          <button onclick="focusNearestZone(${latlng.lat},${latlng.lng},'zone-${feature.properties.CONTAINER_ID || Math.random()}')">
            Show nearest zone
          </button>
        </div>
      `);
      return marker;
    }
  }).addTo(map);
  addLayerControl();
});

// Ø¯Ø§Ù„Ø© Ø¥ÙŠØ¬Ø§Ø¯ Ø£Ù‚Ø±Ø¨ Ù…Ù†Ø·Ù‚Ø©
function focusNearestZone(lat, lng, labelId){
  if (!zonesCenters.length) {
    alert("Ù„Ù… ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ Ø¨Ø¹Ø¯.");
    return;
  }
  let minDist = Infinity, nearestZone = null;
  zonesCenters.forEach(zone => {
    const d = Math.sqrt(Math.pow(zone.center.lat - lat,2) + Math.pow(zone.center.lng - lng,2));
    if (d < minDist) {
      minDist = d;
      nearestZone = zone;
    }
  });
  if (nearestZone) {
    document.getElementById(labelId).innerText = nearestZone.name;
    map.setView(nearestZone.center, 18);
  }
}

// ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ø·Ø¨Ù‚Ø§Øª
function addLayerControl(){
  if(wasteContainersLayer && zonesLayer){
    L.control.layers({}, {"Zones":zonesLayer, "Waste Containers":wasteContainersLayer}).addTo(map);
  }
}
</script>
</body>
</html>






















