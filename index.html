<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Ramallah Waste Containers</title>

<!-- Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" />
<link rel="stylesheet" href="https://unpkg.com/leaflet-control-search/dist/leaflet-search.min.css" />

<style>
  body { margin:0; height:100%; width:100%; }
  #map { position:absolute; top:0; bottom:0; width:100%; }
  .coordinate-control {
    background: rgba(255,255,255,0.8);
    padding: 5px 10px;
    border-radius: 5px;
    font-size: 12px;
    font-weight: bold;
  }
  .leaflet-control-search input { width: 200px; padding: 3px; }
</style>
</head>
<body>
<div id="map"></div>

<!-- JS Libraries -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-control-search/dist/leaflet-search.min.js"></script>

<script>
// Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
const map = L.map('map', { zoomSnap:0.5, center:[31.9045,35.2045], zoom:17.5 });

// Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ø¨Ù‚Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
  attribution:'&copy; OpenStreetMap contributors &copy; CARTO',
  subdomains:'abcd', maxZoom:20
}).addTo(map);

// Ù…Ù‚ÙŠØ§Ø³ Ø§Ù„Ø±Ø³Ù…
L.control.scale({ position:'bottomright', metric:true, imperial:false, maxWidth:150 }).addTo(map);

// Ø¥Ø´Ø§Ø±Ø© Ø§Ù„Ø´Ù…Ø§Ù„
const northControl = L.Control.extend({
  options:{ position:'topright' },
  onAdd: function(map){
    const container = L.DomUtil.create('div');
    container.style.width='40px';
    container.style.height='40px';
    container.style.backgroundImage="url('https://upload.wikimedia.org/wikipedia/commons/3/3c/North_arrow_04.png')";
    container.style.backgroundSize="contain";
    container.style.backgroundRepeat="no-repeat";
    container.style.backgroundPosition="center";
    return container;
  }
});
map.addControl(new northControl());

// Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª
const coordsControl = L.control({ position:'bottomleft' });
coordsControl.onAdd = function(map){
  const div = L.DomUtil.create('div','coordinate-control');
  div.innerHTML='Lat: -- , Lng: --';
  map.on('mousemove', e => {
    div.innerHTML=`Lat: ${e.latlng.lat.toFixed(5)}, Lng: ${e.latlng.lng.toFixed(5)}`;
  });
  return div;
};
coordsControl.addTo(map);

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ø¨Ù‚Ø§Øª
let wasteContainersLayer, zonesLayer;

// ØªØ­Ù…ÙŠÙ„ Ù†Ù‚Ø§Ø· Ø§Ù„Ø­Ø§ÙˆÙŠØ§Øª Ù…Ø¹ popup Ù…ØªØ·ÙˆØ±
$.getJSON("wasteContainer.json", function(WC){
  wasteContainersLayer = L.geoJson(WC, {
    pointToLayer: (feature, latlng) => {
      const marker = L.circleMarker(latlng, {
        radius:6, fillColor:"#ff9800", color:"#fff", weight:1, opacity:1, fillOpacity:0.9
      });
      const popupHTML = `
        <div style="text-align:center;">
          <h4 style="margin:4px;">ğŸ—‘ï¸ ${feature.properties.name || 'Container'}</h4>
          <p>ğŸ“ ${feature.properties.area || 'Unknown area'}</p>
          <img src="https://cdn-icons-png.flaticon.com/512/679/679922.png" width="60"><br>
          <button onclick="alert('Nearest zone feature coming soon!')" style="margin-top:5px;">Show nearest zone</button>
        </div>`;
      marker.bindPopup(popupHTML);
      return marker;
    }
  }).addTo(map);
  addLayerControl();
});

// ØªØ­Ù…ÙŠÙ„ Ù…Ù†Ø§Ø·Ù‚ Ø±Ø§Ù… Ø§Ù„Ù„Ù‡
$.getJSON("RamallahZones.json", function(RZ){
  zonesLayer = L.geoJson(RZ, {
    style: feature => ({
      fillColor:"yellow", fillOpacity:0.3, color:"yellow", weight:1, opacity:0.7
    }),
    onEachFeature: (feature, layer) => {
      layer.on('click', () => {
        const popupHTML = `
          <div style="text-align:center;">
            <h4 style="margin:4px;">ğŸ“ ${feature.properties.TYPE_OF_WA}</h4>
            <p>Ø±Ù…Ø² Ø§Ù„Ø¨Ø±ÙŠØ¯: ${feature.properties.MAIL_CODE || 'ØºÙŠØ± Ù…ØªÙˆÙØ±'}</p>
          </div>`;
        layer.bindPopup(popupHTML).openPopup();
      });
    }
  }).addTo(map);

  // Ø§Ù„Ø¨Ø­Ø« Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚
  const searchControl = new L.Control.Search({
    layer: zonesLayer,
    propertyName: 'TYPE_OF_WA',
    marker:false,
    textPlaceholder:'Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ù†Ø·Ù‚Ø©...',
    moveToLocation: (latlng,title,map) => map.setView(latlng,18)
  });
  map.addControl(searchControl);

  addLayerControl();
});

// Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ø·Ø¨Ù‚Ø§Øª
function addLayerControl(){
  if(wasteContainersLayer && zonesLayer){
    L.control.layers({}, {
      "Zones":zonesLayer,
      "Waste Containers":wasteContainersLayer
    }).addTo(map);
  }
}
</script>
</body>
</html>





















